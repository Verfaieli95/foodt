<?php 

    // First we execute our common code to connection to the database and start the session 
    require("common.php"); 

?>

<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Pet Food Level Tracker</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

	</head>
	<body>
        
        

		<!-- Header -->
			<section id="header">
			<header>
					<?php
					if(!empty($_SESSION['user'])) 
					{
						echo '<a href="logout.php" 
                        data-ajax="false">Logout</a>';
						echo "<br>Hello, "; 
						echo htmlentities($_SESSION['user']['username'], ENT_QUOTES, 'UTF-8'); 
						echo "!<br><br>";
					}
					else
					{
                    echo '<div data-role="main" class="ui-content">
                    <a href="#myPopup" data-rel="popup" class="ui-btn ui-btn-inline ui-corner-all ui-icon-check ui-btn-icon-left">Login</a>
                    <div data-role="popup" id="myPopup" class="ui-content" style="min-width:250px;">
   
						 
                        <h1>Login</h1> 
						<form action="login.php" method="post" data-ajax="false"> 
						 <div>
						<label for="usrnm" class="ui-hidden-accessible">Username:</label>
                        <input type="text" name="username" id="usrnm" placeholder="Username">
					    <label for="pswd" class="ui-hidden-accessible">Password:</label>
					    <input type="password" name="password" id="pswd" placeholder="Password">
					    <input type="submit" data-inline="true" value="Log in">

						</div>
						</form> 
						</div>
                        <br>
						<a href="register.php"
                        data-ajax="false">Register</a><br><br>';

					}
					?>
					<span class="image avatar"><img src="images/avatar.jpg" alt="" /></span>
					<h1 id="logo"><a href="#">Pet Food Level Tracker</a></h1>
					<!--<p>Tracking how much your pets devoured<br/>
					since 2016<br/>-->
					<?php
					if(!empty($_SESSION['user'])) 
					{
						echo "Tracking how much ";
						echo htmlentities($_SESSION['user']['username'], ENT_QUOTES, 'UTF-8');
						echo "'s pets devoured since 2016.<br/>";
					}
					else
					{
					echo "Tracking how much your pets devoured since 2016.";
					}
					?>
</header>
				<nav id="nav">
					<ul>
						<li><a href="#one" class="active">Food tracker</a></li>
						<li><a href="#two">Settings</a></li>
                        <li><a href="#three">Charts</a></li>
                        <li><a href="#four">About</a></li>
                        <li><a href="http://www.fajnyblog.com">Blog</a></li> linka walnac tu
					</ul>
				</nav>
				<footer>
					<ul class="icons">
						<li><a href="#" class="icon fa-github"><span class="label">Github</span></a></li>
						<li><a href="#" class="icon fa-envelope"><span class="label">Email</span></a></li>
					</ul>
				</footer>
			</section>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">

						<!-- One -->
                            <section id="one">
								<div class="container">
									<header class="major">
										<h2>Food tracker</h2>
								

									</header>
									<p>
                                 
                                    </p>
								</div>
							</section>
                            <section id="two">
								<div class="container">
									<header class="major">
										<h2>Settings</h2>
									</header>
									<p>
                                    <p>
                                    <?php




                                    if(!empty($_SESSION['user'])) 
                                    {  
                                    echo 'Here you can set minimum amount of food, water, and temperature and humidity levels, below which site will send a notification to your phone. 
                                    <form action="insert.php" method="post" data-ajax="false">';
                                        $uid = $_SESSION['user']['id'];
                                        $query = " 
                                                    SELECT 
                                                        food_minimum, 
                                                        water, 
                                                        temperature_min, 
                                                        temperature_max,
                                                        humidity_min,
                                                        humidity_max
                                                    FROM devices 
                                                    WHERE 
                                                        id = :uid
                                                "; 
                                        $query_params = array( 
                                            ':uid' => $uid,
                                        ); 

                                        try 
                                        { 
                                            // Execute the query against the database 
                                            $stmt = $db->prepare($query); 
                                            $result = $stmt->execute($query_params); 
                                        } 
                                        catch(PDOException $ex) 
                                        { 
                                            // Note: On a production website, you should not output $ex->getMessage(). 
                                            // It may provide an attacker with helpful information about your code.  
                                            die("Please don't leave anything blank!"); 
                                        } 
                                        $row = $stmt->fetch(); 
        if($row) 
        { 
        $t = time();
        echo($t);
        echo '<br>';
        echo 'Minimum amount of food in grams: <input type="number" min="1" name="food_minimum" id="food_minimum" value="';
        echo $row['food_minimum'];
        echo '"><br>Minimum amount of water in milis: <input type="number" name="water_minimum" min="1" id="water_minimum" value="';
        echo $row['water'];
        echo '"><br>Temperature in Celsius degrees between: <input type="number" name="temperature_min" min="1" max="50" id="temperature_min" value="';
        echo $row['temperature_min'];
        echo '"><br>and: <input type="number" name="temperature_max" min="1" max="50" id="temperature_max" value="';
        echo $row['temperature_max'];
        echo '"><br>Humidity in % between:<input type="number" name="humidity_min" min="1" max="100" id="humidity_min" value="';
        echo $row['humidity_min'];
        echo '"><br>and:<input type="number" name="humidity_max" min="1" max="100" id="humidity_max" value="';
        echo $row['humidity_max'];
        echo '"><br>';
        } 
       echo '<input type="submit" value="Submit">
                                                </form>';
                                                            }
                                                                                            else
                                                                                            {
                                                                                            echo "Content here is available only to members. Please register and login!";
                                                                                            }
					                   ?>
                                    </p>
								</div>
							</section>
							<section id="three">
								<div class="container">
									<header class="major">
										<h2>Charts</h2>
										<p>opis</p>
									</header>
									<p>
                                    <canvas id="myChart" width="300" height="300"></canvas>
                                    </p>
								</div>
							</section>
                            <section id="four">
								<div class="container">
									<header class="major">
										<h2>About</h2>
										<p>opis</p>
									</header>
									<p>
                                    chyba niepotrzebne  
                                    </p>
								</div>
							</section>
                            
					</div>

				<!-- Footer -->
					<section id="footer">
						<div class="container">
							<ul class="copyright">
								<li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
							</ul>
						</div>
					</section>

			</div>

		<!-- Scripts -->
            <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
            <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>
            <script src="assets/js/Chart.js"></script>
            <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
            <link rel="stylesheet" href="assets/css/main.css" />
        
            <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
            <!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->

            <script>    
                var ctx = $("#myChart");
                
                var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ["zjedzone kable", "obgryzione buty", "zgubione wasy", "rozsypane siano"],
                    datasets: [{
                        label: 'szynszyle kwadratowe',
                        data: [17, 31, 10, 26],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                        ],
                        borderColor: [
                            'rgba(255,99,132,1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero:true
                            }
                        }]
                    }
                }
            });
                
            </script>   
	</body>
</html>